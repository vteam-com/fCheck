<svg width="3000" height="1700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .actor-box {
        fill: #2563eb;
        stroke: #1e40af;
        stroke-width: 2;
      }

      .actor-text {
        fill: white;
        font-family: 'Segoe UI', Arial, sans-serif;
        font-size: 13px;
        font-weight: bold;
      }

      .lifeline {
        stroke: #6b7280;
        stroke-width: 2;
        stroke-dasharray: 5, 5;
      }

      .activation {
        fill: #fef3c7;
        stroke: #f59e0b;
        stroke-width: 2;
      }

      .message-arrow {
        stroke: #10b981;
        stroke-width: 2;
        fill: none;
        marker-end: url(#arrowhead);
      }

      .return-arrow {
        stroke: #ef4444;
        stroke-width: 2;
        fill: none;
        stroke-dasharray: 4, 3;
        marker-end: url(#arrowhead-red);
      }

      .message-text {
        fill: #374151;
        font-family: 'Segoe UI', Arial, sans-serif;
        font-size: 11px;
      }

      .note-box {
        fill: #f0f9ff;
        stroke: #0284c7;
        stroke-width: 1;
      }

      .note-text {
        fill: #0c4a6e;
        font-family: 'Segoe UI', Arial, sans-serif;
        font-size: 11px;
      }

      .title {
        fill: #111827;
        font-family: 'Segoe UI', Arial, sans-serif;
        font-size: 20px;
        font-weight: bold;
      }

      .subtitle {
        fill: #6b7280;
        font-family: 'Segoe UI', Arial, sans-serif;
        font-size: 16px;
      }

      .section-label {
        fill: #7c3aed;
        font-family: 'Segoe UI', Arial, sans-serif;
        font-size: 14px;
        font-weight: bold;
      }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#ef4444" />
    </marker>
  </defs>

  <rect width="3000" height="1700" fill="white" />

  <text x="1500" y="34" text-anchor="middle" class="title">fCheck</text>
  <text x="1500" y="58" text-anchor="middle" class="subtitle">Unified Architecture Sequence Diagram</text>

  <!-- Actors -->
  <rect x="40" y="80" width="120" height="40" rx="5" class="actor-box" />
  <text x="100" y="105" text-anchor="middle" class="actor-text">User/CLI</text>

  <rect x="220" y="80" width="120" height="40" rx="5" class="actor-box" />
  <text x="280" y="105" text-anchor="middle" class="actor-text">AnalyzeFolder</text>

  <rect x="380" y="80" width="120" height="40" rx="5" class="actor-box" />
  <text x="440" y="105" text-anchor="middle" class="actor-text">FileUtils</text>

  <rect x="530" y="80" width="140" height="40" rx="5" class="actor-box" />
  <text x="600" y="105" text-anchor="middle" class="actor-text">AnalyzerRunner</text>

  <rect x="710" y="80" width="180" height="40" rx="5" class="actor-box" />
  <text x="800" y="105" text-anchor="middle" class="actor-text">HardcodedStringAnalyzer</text>

  <rect x="910" y="80" width="180" height="40" rx="5" class="actor-box" />
  <text x="1000" y="105" text-anchor="middle" class="actor-text">MagicNumberAnalyzer</text>

  <rect x="1110" y="80" width="130" height="40" rx="5" class="actor-box" />
  <text x="1175" y="105" text-anchor="middle" class="actor-text">SecretAnalyzer</text>

  <rect x="1260" y="80" width="180" height="40" rx="5" class="actor-box" />
  <text x="1350" y="105" text-anchor="middle" class="actor-text">SourceSortAnalyzer</text>

  <rect x="1460" y="80" width="185" height="40" rx="5" class="actor-box" />
  <text x="1552" y="105" text-anchor="middle" class="actor-text">DuplicateCodeAnalyzer</text>

  <rect x="1665" y="80" width="170" height="40" rx="5" class="actor-box" />
  <text x="1750" y="105" text-anchor="middle" class="actor-text">DeadCodeAnalyzer</text>

  <rect x="1855" y="80" width="190" height="40" rx="5" class="actor-box" />
  <text x="1950" y="105" text-anchor="middle" class="actor-text">DocumentationAnalyzer</text>

  <rect x="2065" y="80" width="150" height="40" rx="5" class="actor-box" />
  <text x="2140" y="105" text-anchor="middle" class="actor-text">LayersAnalyzer</text>

  <rect x="2235" y="80" width="150" height="40" rx="5" class="actor-box" />
  <text x="2310" y="105" text-anchor="middle" class="actor-text">MetricsAnalyzer</text>

  <rect x="2405" y="80" width="130" height="40" rx="5" class="actor-box" />
  <text x="2470" y="105" text-anchor="middle" class="actor-text">ProjectMetrics</text>

  <!-- Lifelines -->
  <line x1="100" y1="120" x2="100" y2="1640" class="lifeline" />
  <line x1="280" y1="120" x2="280" y2="1640" class="lifeline" />
  <line x1="440" y1="120" x2="440" y2="1640" class="lifeline" />
  <line x1="600" y1="120" x2="600" y2="1640" class="lifeline" />
  <line x1="800" y1="120" x2="800" y2="1640" class="lifeline" />
  <line x1="1000" y1="120" x2="1000" y2="1640" class="lifeline" />
  <line x1="1175" y1="120" x2="1175" y2="1640" class="lifeline" />
  <line x1="1350" y1="120" x2="1350" y2="1640" class="lifeline" />
  <line x1="1552" y1="120" x2="1552" y2="1640" class="lifeline" />
  <line x1="1750" y1="120" x2="1750" y2="1640" class="lifeline" />
  <line x1="1950" y1="120" x2="1950" y2="1640" class="lifeline" />
  <line x1="2140" y1="120" x2="2140" y2="1640" class="lifeline" />
  <line x1="2310" y1="120" x2="2310" y2="1640" class="lifeline" />
  <line x1="2470" y1="120" x2="2470" y2="1640" class="lifeline" />

  <!-- 1. Initialization and scan -->
  <text x="50" y="155" class="section-label">1. Initialization and directory scan</text>

  <rect x="270" y="170" width="20" height="120" class="activation" />
  <line x1="100" y1="180" x2="270" y2="180" class="message-arrow" />
  <text x="185" y="174" text-anchor="middle" class="message-text">analyze()</text>

  <rect x="430" y="195" width="20" height="35" class="activation" />
  <line x1="290" y1="205" x2="430" y2="205" class="message-arrow" />
  <text x="360" y="199" text-anchor="middle" class="message-text">scanDirectory()</text>
  <line x1="430" y1="230" x2="290" y2="230" class="return-arrow" />
  <text x="360" y="246" text-anchor="middle" class="message-text">dartFiles + counters</text>

  <rect x="430" y="242" width="20" height="28" class="activation" />
  <line x1="290" y1="250" x2="430" y2="250" class="message-arrow" />
  <text x="360" y="267" text-anchor="middle" class="message-text">countCustomExcludedDartFiles()</text>
  <line x1="430" y1="270" x2="290" y2="270" class="return-arrow" />

  <!-- 2. Configuration and delegates -->
  <text x="50" y="305" class="section-label">2. Project config and analyzer assembly</text>
  <rect x="270" y="315" width="20" height="110" class="activation" />

  <rect x="300" y="325" width="260" height="70" rx="4" class="note-box" />
  <text x="312" y="343" class="note-text">- resolve project type &amp; localization</text>
  <text x="312" y="359" class="note-text">- evaluate enabled analyzers</text>
  <text x="312" y="375" class="note-text">- instantiate Delegates for Runner</text>

  <!-- 3. Unified single-pass analysis -->
  <text x="50" y="455" class="section-label">3. Unified single-pass data collection (Delegate Pattern)</text>

  <line x1="290" y1="470" x2="590" y2="470" class="message-arrow" />
  <text x="440" y="464" text-anchor="middle" class="message-text">analyzeAll(delegates)</text>

  <rect x="590" y="465" width="20" height="420" class="activation" />

  <text x="614" y="495" class="section-label">For EACH file, calls EVERY enabled delegate:</text>

  <!-- Delegate calls -->
  <rect x="790" y="510" width="20" height="20" class="activation" />
  <line x1="610" y1="520" x2="790" y2="520" class="message-arrow" />
  <text x="700" y="515" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="990" y="540" width="20" height="20" class="activation" />
  <line x1="610" y1="550" x2="990" y2="550" class="message-arrow" />
  <text x="800" y="545" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="1165" y="570" width="20" height="20" class="activation" />
  <line x1="610" y1="580" x2="1165" y2="580" class="message-arrow" />
  <text x="887" y="575" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="1340" y="600" width="20" height="20" class="activation" />
  <line x1="610" y1="610" x2="1340" y2="610" class="message-arrow" />
  <text x="975" y="605" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="1542" y="630" width="20" height="20" class="activation" />
  <line x1="610" y1="640" x2="1542" y2="640" class="message-arrow" />
  <text x="1076" y="635" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="1740" y="660" width="20" height="20" class="activation" />
  <line x1="610" y1="670" x2="1740" y2="670" class="message-arrow" />
  <text x="1175" y="665" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="1940" y="690" width="20" height="20" class="activation" />
  <line x1="610" y1="700" x2="1940" y2="700" class="message-arrow" />
  <text x="1275" y="695" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="2130" y="720" width="20" height="20" class="activation" />
  <line x1="610" y1="730" x2="2130" y2="730" class="message-arrow" />
  <text x="1370" y="725" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <rect x="2300" y="750" width="20" height="20" class="activation" />
  <line x1="610" y1="760" x2="2300" y2="760" class="message-arrow" />
  <text x="1455" y="755" text-anchor="middle" class="message-text">analyzeFileWithContext()</text>

  <line x1="590" y1="870" x2="290" y2="870" class="return-arrow" />
  <text x="440" y="865" text-anchor="middle" class="message-text">AnalysisRunnerResult</text>

  <!-- 4. Post-processing -->
  <text x="50" y="925" class="section-label">4. Post-processing: Multi-file Analysis &amp; Aggregation</text>
  <rect x="270" y="940" width="20" height="420" class="activation" />

  <rect x="1542" y="960" width="20" height="40" class="activation" />
  <line x1="290" y1="975" x2="1542" y2="975" class="message-arrow" />
  <text x="916" y="969" text-anchor="middle" class="message-text">analyze(duplicatedFileData)</text>
  <line x1="1542" y1="1000" x2="290" y2="1000" class="return-arrow" />

  <rect x="1740" y="1030" width="20" height="40" class="activation" />
  <line x1="290" y1="1045" x2="1740" y2="1045" class="message-arrow" />
  <text x="1015" y="1039" text-anchor="middle" class="message-text">analyze(deadCodeFileData)</text>
  <line x1="1740" y1="1070" x2="290" y2="1070" class="return-arrow" />

  <rect x="1940" y="1100" width="20" height="40" class="activation" />
  <line x1="290" y1="1115" x2="1940" y2="1115" class="message-arrow" />
  <text x="1115" y="1109" text-anchor="middle" class="message-text">analyze(docIssues)</text>
  <line x1="1940" y1="1140" x2="290" y2="1140" class="return-arrow" />

  <rect x="2130" y="1170" width="20" height="40" class="activation" />
  <line x1="290" y1="1185" x2="2130" y2="1185" class="message-arrow" />
  <text x="1210" y="1179" text-anchor="middle" class="message-text">analyzeFromFileData(layersData)</text>
  <line x1="2130" y1="1210" x2="290" y2="1210" class="return-arrow" />

  <rect x="2300" y="1240" width="20" height="40" class="activation" />
  <line x1="290" y1="1255" x2="2300" y2="1255" class="message-arrow" />
  <text x="1295" y="1249" text-anchor="middle" class="message-text">aggregate(metricsData)</text>
  <line x1="2300" y1="1280" x2="290" y2="1280" class="return-arrow" />

  <rect x="1950" y="1305" width="460" height="35" rx="4" class="note-box" />
  <text x="1962" y="1328" class="note-text">Consistent post-processing for all complex domain analyzers.</text>
  <rect x="1950" y="1348" width="840" height="35" rx="4" class="note-box" />
  <text x="1962" y="1371" class="note-text">CodeSizeDelegate collects LOC for outliers/treemap, and code_size now feeds MetricsAnalyzer scoring + compliance deductions.</text>

  <!-- 5. Return -->
  <text x="50" y="1415" class="section-label">5. Build ProjectMetrics &amp; Return</text>

  <rect x="2460" y="1430" width="20" height="45" class="activation" />
  <line x1="290" y1="1440" x2="2460" y2="1440" class="message-arrow" />
  <text x="1375" y="1434" text-anchor="middle" class="message-text">ProjectMetrics(results)</text>
  <line x1="2460" y1="1475" x2="290" y2="1475" class="return-arrow" />

  <line x1="270" y1="1510" x2="100" y2="1510" class="return-arrow" />
  <text x="185" y="1526" text-anchor="middle" class="message-text">return ProjectMetrics</text>

</svg>
